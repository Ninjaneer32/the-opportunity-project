{% assign allDatasets = site.data.datasets %}
{% assign matchingSprint = site.data.sprints | where: "Name", page.sprint-name | first %}
{% assign display-dataset = allDatasets | where_exp: "dataset", 
  "dataset.sprint contains matchingSprint.airtable_id" %}
{% assign problem_statements = "" | split: ',' %}
{% for ps in matchingSprint.problem_statements %}
  {% assign match = site.data.problem_statements | where: "airtable_id", ps %}
  {% assign problem_statements = problem_statements | push: match %}
{% endfor %}

<section class="bg-primary-dark usa-section margin-bottom-0 padding-bottom-0">
  <div class="grid-container">
    <div class="display-flex flex-column flex-align-center">
      <form id="data-search-form" class="usa-search usa-search--small desktop:width-tablet" role="search">
        <label class="usa-sr-only" for="search-field">Search datasets by key words</label>
        <input class="usa-input" id="search-field" type="search" name="search" placeholder="Search datsets by key words">
        <button class="btn-link__primary-dark" type="submit">
          <span class="usa-sr-only">Search</span>
        </button>
      </form>
    </div>
    {% if page.dataset == "earth-sprint" %}
      {% assign data-topics = site.data.natural-environment-topics %}
    {% elsif page.dataset == "built-sprint" %}
      {% assign data-topics = site.data.built-environment-topics %}
    {% elsif page.dataset == "covid" %}
      {% assign data-topics = site.data.covid-topics %}
    {% else %}
      {% assign data-topics = site.data.workforce-topics %}
    {% endif %}
    <div class="grid-row grid-gap">
      <ul class="usa-card-group data-card-group margin-top-7">
        {% for data in data-topics %}
          <li id="{{ data.filter }}" class="usa-card" name="productCard">
            <div class="usa-card__container dkh__data-topic {% if forloop.first %}selected{% endif %}">
              <header class="usa-card__header">
                <p class="text-white font-sans-sm" value="{{ data.name | slugify}}">{{ data.name }}</p>
              </header>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
    <div class="grid-row grid-gap">
      {% for data in data-topics %}
        {% if data.description %}
          <div id="modal-{{ data.filter }}" class="data-modal modal-inactive">
            <div class="grid-row">
              <div class="desktop:grid-col-8 tablet:grid-col-8">
                <div class="display-inline-block desktop:grid-col-4 tablet:grid-col-4">
                  <img
                    src="{{ site.baseurl }}/assets/img/challenges/{{data.image}}"
                    alt="{{data.image-alt}}"
                  />
                </div>
                <div class="display-inline-block float-right desktop:grid-col-8 tablet:grid-col-8 padding-bottom-5 padding-left-5">
                  {% if data.title %}
                    <p class="font-sans-md text-white">{{ data.title }}</p>
                  {% endif %}
                  {% if data.description %}
                    <p class="font-mono-xs text-accent-warm">CHALLENGE</p>
                    <p class="font-sans-2xs text-white">{{ data.description}}</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    <hr class="margin-top-3 margin-bottom-0 border-accent-warm">
  </div>
</section>

<section class="bg-primary-dark margin-top-0">
  <section class="usa-section usa-graphic-list grid-container">
    <ul class="usa-card-group">
    {% for item in display-dataset %}
      {% if item.link %}
        {% include dch/dataset-card.html data=item %}
      {% endif %}
    {% endfor %}
    </ul>
    {% if page.dataset == "covid" %}
      <h3 class="font-sans-m text-white">Below are additional points of contacts for Census data in the following topics:</h3>
      {% for expert-group in site.data.covid-census-experts %}
        <p class="font-mono-xs text-accent-warm">{{ expert-group.name }}</p>
        <a href="mailto:{{ expert-group.email }}?subject=Regarding The ASA Challenge" class="font-sans-2xs text-decoration-none text-white">{{ expert-group.poc }}<img src="{{ site.baseurl }}/assets/img/icons/email-white.png" class="padding-left-1" alt="email"></a>
      {% endfor %}
    {% endif %}
  </section>
</section>
